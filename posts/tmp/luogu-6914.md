---
title: luoguP6914 题解 - [ICPC2015 WF]Tours
---

> **题目大意.**
>
> 给定一个无向图。你要找出所有的 $k$，使得存在一种把边染色为 $1\sim k$ 的方案，满足任何一个简单环中每种颜色的边数量恰相等。保证图中至少有一个环。
>
> $n,m\le 10^3$。

定义两个在某边双连通图 $G$ 上的边**切边等价**，当且仅当：在任何 $G$ 的简单环中，这两条边要么同时出现要么同时不出现。

- 显然地，切边等价是一个等价关系。
- 易证：两条边切边等价等价于，从 $G$ 中删去这两条边后 $G$ 不连通。
- 易证：两条边切边等价等价于，任取包含了它们的 $G$ 的生成树 $T$，不存在非树边跨过其中一条却不跨过另一条。这个描述比前两者具体了很多。

自然地 $G$ 中的边被划为数个等价类 $E_i$。（$E_i$ 很容易求，删掉任意一条边后求割边即可得到它所在的等价类）

我们来证明，必须有
$$
\boxed{\forall i, k|\#E_i}
$$
（$\#E_i$ 是 $E_i$ 的大小）

先固定颜色 $c$，记 $y_i$ 是 $E_i$ 中颜色 $c$ 的边的数量。记 $x_i=k\cdot y_i-\#E_i$。只需要证明 $x_i$ 全为 $0$。

很直观地，一个简单环必定是数个 $E_i$ 的（因为 $E_i$ 不就是被环切出来的），自然考虑设 $u_{cyc,i}$ 表示环 $cyc$ 中是否包含 $i$。根据题意应有
$$
\sum_i u_{cyc,i}x_i=0
$$
这给出一个 $x$ 的线性方程组。