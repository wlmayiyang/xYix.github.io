---
title: nimber 运算和扩展
---

参考资料：论文集2020《》罗煜翔

# 什么是 nimber

## 无偏博弈

无偏博弈是一种双人回合制游戏，两人轮流行动，同时局面对两个人是**对称**的，也就是当前的走法与当前行动的是 A 还是 B 无关。

## nim 游戏

nim 游戏是一个无偏博弈。每人轮流从一个石子堆拿走非空的石子，不能行动（当前石子堆为空）的玩家输。

## 斯普莱格–格隆第定理

斯普莱格-格隆第定理（Sprague–Grundy theorem）指出，任何一个以“不能行动的玩家输”为胜利条件的无偏博弈等价于特定大小（一般在 OI 中称为这个游戏的 $\text{SG}$ 函数）（在奇怪的情形下它可能是无限的，这时候需要一些序数理论，这不是我们今天讨论的重点，所以我们可以忽略无限的情况）的 nim 游戏。

从而我们可以用 nim 堆的大小来描述游戏。因为它上面有一些和自然数不同的运算（事实上 nim 数里可能会有 $\omega^{\omega^\omega}$ 之类的奇怪东西）（事实上全体 nim 数甚至不能称为集合，只能称为真类）

# nim 运算基础

为了避免谈论序数，我们以后只谈论 $[0,2^{2^n})$ 内的 nim 数构成的**域**。可以验证它的确对下面介绍的加和乘构成域。

## 附：群是什么

一个集合 $G$ 连带它上面的运算 $\cdot$ 称为一个群，如果

- $G$ 对 $\cdot$ 封闭：$\forall a,b\in G,(a\cdot b)\in G$
- $\cdot$ 具有结合律，$a\cdot(b\cdot c)=(a\cdot b)\cdot c$
- 存在单位元 $e$ 使得 $\forall a,e\cdot a=a\cdot e=a$
- 任意 $\forall a$ 都有逆元 $a^{-1}$ 使得 $a\cdot a^{-1}=a^{-1}\cdot a=e$

请注意我们不要求 $\cdot$ 具有交换律。

## 附：域是什么

一个集合 $R$ 和上面的两个运算 $+,\times$ 称为一个域，如果

- $(R,+)$ 是群，而且 $+$ 具有交换律
- $(R,\times)$ 是半群，即不要求存在单位元和逆元的群
- $+,\times$ 之间满足左右分配律：
- - $a\times(b+c)=a\times b+a\times c$
  - $(b+c)\times a=b\times a+c\times a$

## nim 和

我们考虑一个称为 $a\oplus b$ 的新游戏，它的内容是，参与者每一步都可以选择在 $a$ 游戏**或** $b$ 游戏中走一步。它对应的 nim 数被称为 $a$ 和 $b$ 的 **nim 和**。nim 和以如下的方式定义

> $$
> a\oplus b=\text{mex}(\{a'\oplus b,a'<a\}\cup\{a\oplus b',b'<b\})
> $$

其中 $\text{mex}$ 表示一个集合中第一个没有出现的自然数。

但是其实我们都知道有一个非常简单的办法计算它：它就是 $a\operatorname{xor} b$。

## nim 积

考虑一个称为 $a\otimes b$ 的新游戏，它的内容比较复杂。我们举一个例子。

> 在一个白色平面上，$(x,y)$ 处有一个黑点。这是一个无偏博弈，每个回合，玩家都可以选定一个黑点 $(x,y)$ 和 $0\le x'<x,0\le y'<y$，反转 $(x,y),(x',y),(x,y'),(x',y')$ 的颜色。不能行动者输。

如上的这个游戏就是两个 nim 游戏的 **nim 积**。nim 积以如下的方式定义

>$$
>a\otimes b=\text{mex}(\{(a'\otimes b)\oplus(a\otimes b')\oplus(a'\otimes  b'),a'<a,b'<b\})
>$$

由于打 latex 太累，所以接下来我们会省略 $\bigcirc$。

## 如何计算 nim 积

首先有一些结论

> $$
> 2^{2^x}\times 2^{2^y}=2^{2^{x}}\cdot 2^{2^y}\quad(x\neq y)\\
> 2^{2^x}\times 2^{2^x}=\dfrac 3 2\cdot 2^{2^x}
> $$

容易验证。

我们知道 nimber 是一个域，从而我们可以使用分配律，于是我们拆分 $x,y$ 为二进制
$$
x\times y=\sum 2^{x_i}\times\sum 2^{y_i}=\sum_{i,j}2^{x_i}\times 2^{y_j}
$$
注意 $\sum$ 是 $\bigoplus$ 的省略。