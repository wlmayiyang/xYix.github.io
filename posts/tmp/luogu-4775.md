---
title: luoguP4775 题解 - 【NOI2018】情报中心
---

> 这个样例，无疑是善良的出题人无私的馈赠。大量精心构造的 $n\le 100, m\le 200$ 的测试数据，涵盖了测试点中所有出现性质的组合。你可以利用这个测试点，对自己的程序进行全面的检查。足量的数据组数、不大的数据范围和多种多样的数据类型，能让程序中的错误无处遁形。出题人相信，这个美妙的样例，可以给拼搏于 AC 这道题的逐梦之路上的你，提供一个有力的援助。

> **题目大意.**
>
> 给出一棵带边权树 $T$ 和 $m$ 条链，每条链有一个非正权值。
>
> 你要选出两条有交的链，使得：这两条链本身的权值加至少被其中一条链覆盖的边权之和最大。
>
> $|T|\le 5\times10^4,m\le 10^5$。多测，$\sum |T|\le 10^6,\sum m\le 2\times 10^6$。

根据部分分的提示，分讨两种情况：两条链的最高点相同和不同。

下面记：不考虑有交时单独一条链 $i$ 的贡献为 $w_i$，最高点为 $p_i$。

# 1. LCA 不同

下面是最典型的情况：

<div style="width:70%;margin:auto"><img src="https://xyix.gitee.io/images/luogu-4775-1.png" alt=""></div>

可见，$X$ 点是最关键的点。下面写出一些事实：

- 这种方案的贡献为 ${\color{red}w}+{\color{blue}w}-\text{dep}(X)+\max({\color{red}\text{dep}(p)},{\color{blue}\text{dep}(p)})$。
- 这种方案实际存在，当且仅当
- 