$$
\begin{aligned}
F_u&=\min_{d_u-d_v\le l}F_ v+p_u(d_u-d_v)+q_u\\
&=p_ud_u+q_u+\min_{d_u-d_v\le l}F_v-p_ud_v
\end{aligned}
$$

$$
\begin{aligned}
F_{v1}\prec F_{v_2}&\Leftrightarrow F_{v1}-p_ud_{v1}<F_{v_2}-p_ud_{v2}\\
&\Leftrightarrow F_{v1}-F_{v2}<p_u(d_{v1}-d_{v2})\\
&\Leftrightarrow (d_{v1}<d_{v2})\operatorname{xor}\left(\dfrac{F_{v1}-F_{v2}}{d_{v1}-d_{v2}}<p_u\right)
\end{aligned}
$$

