---
title: luoguP6774 题解 - 时瑇的眼泪
---

# 1. 引子

这是一道恐怖的 Ynoi。

> **题目大意.**
>
> 给出一个排列。求区间逆序对。**强制在线**。
>
> $n,q$ 同阶，要求时空复杂度 $O(n\sqrt n)$。

考虑分块。

- 边角到自身的贡献可以预处理。

- 边角-另一个边角可以预先排序，取出其中想要的元素然后直接归并。

- 边角-整块可以直接对每个关键点 $i=B, 2B, 3B,...$ 处求出 $1\sim i$ 所有元素中有多少个 $\le x$。扫一遍边角即可。
- 整块内部也可以直接预处理。

# 2. 正题

这是一道更加恐怖的 Ynoi。

> **题目大意.**
>
> 给出一个排列，求下标在 $[lx,rx]$ 中，值在 $[ly,ry]$ 中元素的逆序对数。
>
> $n,q$ 同阶，要求时空复杂度 $O(n\sqrt n)$。

- 边角-边角仍是直接的。
- 边角-整块