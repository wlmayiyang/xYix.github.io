---
title: AGC033F 题解 - Adding Edges
---

> **题目大意.**
>
> 现有一个 $n$ 个节点的树 $T$ 和一张 $n$ 个节点 $m$ 条边的无向图 $G$。不断重复以下操作：
>
> - 选择三个节点 $a,b,c$ 使得 $G$ 中存在 $(a,b),(b,c)$ 但不存在 $(a,c)$，而 $T$ 中存在一条链包含了 $a,b,c$。加入边 $(a,c)$。
>
> 求最终 $G$ 的边数。可以证明这与操作顺序无关。
>
> $n,m\le 2\times10^3$。

考虑强制要求 $a,b,c$ 必须在 $T$ 上顺序出现的情形，可见最终的 $G$ 中有边 $(x,y)$ 当且仅当存在序列 $x,u_1,...,u_{\ell},y$ 使得它们在 $T$ 上的一条链上恰好顺序出现，且 $(x,u_1),(u_1,u_2),...$ 等皆存在于 $G$ 中。直接在 $G$ 上从每个点开始搜即可。

$a,b,c$ 必须顺序出现的情形的性质的确很好，现在考虑从 $a,b,c$ 不必顺序出现向它转化。

现有在 $T$ 上顺序出现的 $a,b,c$。注意到 $(a,b),(a,c),(b,c)$ 中如果已有任意两者一定可以推出剩下一者，而又已经预先告诉我们操作顺序与答案无关，所以我们不妨总是把 $(a,b)+(a,c)$ 转换为 $(a,b)+(b,c)$，这样就可以按顺序出现做了。

那么问题就是如何转换。

