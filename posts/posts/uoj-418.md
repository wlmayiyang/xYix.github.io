---
title: uoj#418 题解 - 【集训队作业2018】三角形
---

> **题目大意.**
>
> 现有一棵有根树，每个节点有权值 $w_i$ 且每个节点初始都没有石子。你在第 $i$ 个节点总是只能要么不放石子要么放 $w_i$ 个石子。
>
> - 你可以在任意时刻收回一个节点的石子。
> - $i$ 的儿子上都有石子时你才能在 $i$ 上放石子。
>
> 对于任意节点 $i$，你要求出：现在你希望在 $i$ 上放石子。求一开始你手中至少有多少颗石子。

**观察 1.** 试图求解子问题的影响只能是：

- 在求解途中最多要放 $b_i$ 枚石子。
- 最终要留下 $a_i$ 枚石子。

**观察 2.** 考虑只有两个点 $f,s$ 的简单情况。可看作新问题 $(a_f,\max(b_s,b_f+a_s))$。

**观察 3.** 把叶子们按某种顺序往父亲合并一定能且恰好能构造出所有合法操作序列。研究重心转为研究合并顺序。

**观察 4.** 首先合并意味着最后操作。$b_i$ 较大的节点的“合并意愿”不强。$a_i$ 较大的节点“合并意愿”很强。定量地来说，考虑节点 $f,s_1,s_2$，$s_1$ 早于 $s_2$ 合并当且仅当
$$
\max (b_{s2},a_{s2}+b_{s1},a_{s2}+a_{s1}+b_f)\le\max (b_{s1},a_{s1}+b_{s2},a_{s1}+a_{s2}+b_f)
$$
显然地 $b_{s2}\le\text{RHS},a_{s2}+a_{s1}+b_f\le \text{RHS}$。只需要考虑
$$
a_{s2}+b_{s1}\le\max(a_{s1}+b_{s2},a_{s1}+a_{s2}+b_f)
$$

$$
b_{s1}-a_{s1}\le \max(b_{s2}-a_{s2},b_f)
$$

好的，我们解决了菊花的情形（

**观察 5.** 可见 $b_i-a_i$ 是一个重要的量。