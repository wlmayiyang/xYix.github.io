---
title: luoguP7520 题解 - 【省选联考 2020】支配
---

> **题目大意.**
>
> 给出一个有向图 $G$。如果从 $1$ 出发到 $v$ 的任何路径都会经过 $u$，则称 $u$ **支配** $v$。所有支配点 $v$ 的点构成**受支配集** $D_v$。
>
> 现有 $q$ 次询问，形如：若加上边 $(u,v)$，会有多少个点的受支配集发生变动。
>
> $|V|\le 3\times10^4,|E|\le 2|V|,q\le 2\times10^4$。

**观察 1.** 显然支配具有传递性，且两个点不可能同时支配某点却不互相支配，故支配关系形成了一个树形结构，是为**支配树**。

在本题中由于数据范围较小，我们可以通过一个简单的方式求出支配树：从图中抠掉点 $u$ 然后从 $1$ 开始跑一遍，到不了的就是 $u$ 在支配树上的子树。

**观察 2.** 加入一条边 $(u,v)$ 会让 $v$ 的父亲变为 $u,v$ 的 LCA。

但是 $v$ 的 LCA 一旦变动又会导致原先的所有 $(v,w)$ 产生类似效应并传播出去，若直接模拟复杂度肯定很差。

**观察 3.** 一个点的受支配集就是其祖先。若要使 $u$ 的受支配集变动，必定是其祖先中至少有一个的父亲变为了更早的祖先。于是我们可以考虑搞出所有父亲变动的点，所欲求即为它们的子树并。

**观察 4.** 一个点 $w$ 的父亲变动，其实就是其父亲不能再支配它。即：如果从图中扣掉 $\text{fa}(w)$，$1$ 仍能走到它。而且这条路径显然必定利用了新加的 $(u,v)$。那么就相当于问

- $1$ 到 $u$ 是否有不经过 $\text{fa}(w)$ 的路径？这个问题的答案是显然的。
- $v$ 到 $w$ 是否有不经过 $\text{fa}(w)$ 的路径？这东西可以预处理。抠掉 $\text{fa}(w)$ 从 $w$ 跑一遍即可。

于是就做完了。

