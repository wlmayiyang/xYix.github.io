---
title: LNR#2 题解
---

# D1T1 - 单枪匹马

思博题！

# D1T2 - 黄金矿工

> **题目大意.**
>
> 考虑下面这个问题：
>
> > 现在有这样一个费用流模型：
> >
> > - 有一个源点，一个汇点，另有 $n$ 个其他点。
> > - 有一些从源点连出的边，容量为 $1$，费用为小于 $0$ 的整数。
> > - 有一些连向汇点的边，容量为 $1$，费用为小于 $0$ 的整数。
> > - 在 $n$ 个其他点上有一棵外向树形图，每条边的容量都为 $+\infty$，费用为小于 $0$ 的整数。
> >
> > 你要回答最小费用流是多少。注意你不必使得流量最大。
>
> 你要支持：动态添加从源点连出的边和连向汇点的边，并随时回答以上问题。
>
> $n\le 10^5,q\le 10^5$。

好像不支持修改都不简单！

肯定要考虑模拟费用流。<span style="color: #36c48e">由于可以随时反悔且要求的是"最小费用流"，所以就没必要强求增广路径权值最大了。而且需要记住我们根本不在意流量。</span>那么所谓操作也就是加入新边后再次考虑能不能增广。

如果不考虑反悔，实际上找的就是使得 $w(u)-\text{dep}(u)+w(v)+\text{dep}(v)$ 为正的，且具有祖先关系的 $u,v$。

问题是能反悔。这里有一个有趣的想法：把反向边 $\text{Rev}(S\rightarrow u)$ 换为一条同流量同权值和费用的 $u\rightarrow T$ 的边，$\text{Rev}(v\rightarrow T)$ 亦然。

- 注意我们不关心流量，所以 $u$ 流回 $S$ 开始一条新的增广路和 $u$ 流到 $T$ 再开始一条新的增广路对我们而言没有区别，所以这个转化是合法的；
- 而又注意到这实际上增加了一个权值为 $-w(u)+\text{dep}(u)$ 的金矿，所以这个转化是有益的。

然而还有一种反向边——即树上的反向边——仍需要处理。

对于树上反向边，很显然我们能走必然走，大不了再走回来就好了。于是通过一些树上数据结构即可维护。

# D1T3 - 不等关系

