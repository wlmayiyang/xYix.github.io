---
title: 容斥符号化 - 更炫酷的反演魔术
---

对之前那篇组合对象符号化的补充。

# 例子：错排问题

考虑所有置换构成的组合类 $\mathcal P$。构造 $\mathcal Q$ 是这样的一个组合类，其中元素都是置换，而我们还可以标记一些不动点。也就是说，同一个置换但是一个不动点标不标记是两个在 $\mathcal Q$ 中的对象。$\mathcal Q$ 是容易计数的：标记的点必须守序（标号为 $1,2,3,...$，毕竟它们是不动点）而其他点不必，从而有
$$
\mathcal Q=\text{SET}(\mathcal Z)\star\mathcal P
$$
我们在 GF 中用一个新的变元 $u$ 指出 $\mathcal Q$ 中元素的标记点的数量：
$$
Q(u,z)=\dfrac{e^{uz}}{1-z}
$$
我们还是用 $u$ 指出 $\mathcal P$ 中**不动点**的数量，显然 $\mathcal P$ 中的不动点（一个 $u$ 的贡献）都可以选择标记和不被标记，即贡献 $u$ 或贡献 $1$。从而通过这个 $u\to u+1$ 立即得到
$$
Q(u,z)=P(u+1,z)
$$

$$
P(0,z)=\dfrac{e^{-z}}{1-z}
$$

问题得到解决。事实上我们可以直接扩展到一般的二项式反演。

从这个问题中看不大出容斥符号化的优越性。来个更劲爆的？

# 例子：莫比乌斯反演

我们有
$$
f_n=\sum_{d|n}g_d
$$
则 $g=?$

首先明确，一个整数可以看成它的质因子分解序列，比如 $12=(2,1,0,0...)$ 我们把整个序列作为它的大小函数。单个元素的 GF 就是 $x_1^{e_1}x_2^{e_2}...$，比如 $T(12;x_1,x_2,...)=x_1^2x_2$。容易验证这个 GF 在“笛卡尔积”下积性。则我们有
$$
\mathcal F=\N\times\mathcal G
$$
考虑 $\N$ 的 GF，它当然是 $\prod_{i=1}^{\infty}\dfrac{1}{1-x_i}$。那么我们甚至不需要构造新的 $\mathcal Q$（事实上 $\mathcal F$ 就是我们想要的 $\mathcal Q$）就直接可以得到 $G=F\prod_{i=1}^{\infty}(1-x_i)$。而后面那个东西则是我们熟知的莫比乌斯函数。

这个例子不是很恰当，因为其实我们只是重新发明了狄利克雷生成函数而已。来个更劲爆的？

# 例子：min-max 容斥

考虑 GF $T(t)=\max t \cdot x_1^{c_1}x_2^{c_2}...x_n^{c_n}$。其中 $c_i=[i\in t]$。元素已经从小到大排序。容易写出整个组合类的 GF 为
$$
\sum_{i=1}^n v_ix_i\prod_{j<i} (1+x_j)
$$
取 $\forall i,x_i=-1$ 立即得到 min-max 容斥。

当然我们更熟悉的 min-max 容斥其实是在期望上的，实际上它很好证明。因为在任意一个基本事件上都有 min-max 容斥，再根据期望的线性便立即得证。

来个更劲爆的？

# 例子：扩展 min-max 容斥

显然上面的式子爆炸了。根本原因在于它的构造依赖于 $0^{x}=[x=0]$。那么我们代入 $x_i=\begin{cases}0&(i<k)\\-1&(i\ge k)\end{cases}$ 不就好了吗！（智将）

其实这道理也是有的，但是我们更希望各自变量平等（不然可能会很难受。关键在于我们往往分辨不出是否有 $i<k$，能分辨出的话也没必要容斥）。显然这时 $x_i$ 取任何值都不能满足我们的要求，所以我们考虑给 $x^i$ 自带一个权值 $f(i)$。比如原来就是 $f(i)=(-1)^i$。那么这个权值要满足
$$
\sum_{j=0}^{i-1}{i-1\choose j}f(j+1)=0\quad(i\neq k)\\
\sum_{j=0}^{k-1}{k-1\choose j}f(j+1)\neq 0
$$
草，这就没意思了，直接二项式反演即可。不过可以看到的是，符号化方法为我们指明了道路，还提供了一个对所谓“容斥系数”的高妙解释。

